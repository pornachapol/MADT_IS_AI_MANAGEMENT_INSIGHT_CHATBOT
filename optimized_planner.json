{
  "predict.predict": {
    "traces": [],
    "train": [],
    "demos": [
      {
        "question": "เดือน 11 ปี 2025 เทียบกับเดือน 10 ปี 2025 ยอดขายเป็นเงินรวมเป็นยังไง?",
        "intent": "monthly_revenue_vs_prev_month",
        "sql": "\n        WITH monthly_revenue AS (\n            SELECT\n                d.year,\n                d.month,\n                SUM(c.contract_count * p.base_price) AS total_revenue\n            FROM fact_contract c\n            JOIN dim_date d    ON c.date_key   = d.date_key\n            JOIN dim_product p ON c.product_id = p.product_id\n            WHERE d.year = 2025\n              AND d.month IN (10, 11)\n            GROUP BY d.year, d.month\n        )\n        SELECT\n            cur.year,\n            cur.month           AS current_month,\n            cur.total_revenue   AS current_revenue,\n            prev.month          AS prev_month,\n            prev.total_revenue  AS prev_revenue,\n            cur.total_revenue - prev.total_revenue AS diff_revenue,\n            CASE\n                WHEN prev.total_revenue = 0 THEN NULL\n                ELSE ROUND(\n                    (cur.total_revenue - prev.total_revenue) * 100.0 / prev.total_revenue,\n                    2\n                )\n            END AS growth_pct\n        FROM monthly_revenue cur\n        LEFT JOIN monthly_revenue prev\n          ON cur.year  = prev.year\n         AND cur.month = 11\n         AND prev.month = 10;\n    "
      },
      {
        "question": "ขอดูยอดขายต่อวันในเดือนพฤศจิกายน 2025 รวมทุกสาขาให้หน่อย",
        "intent": "daily_sales_trend_mtd",
        "sql": "\n        SELECT\n            d.date,\n            SUM(c.contract_count) AS total_units_sold\n        FROM fact_contract c\n        JOIN dim_date d ON c.date_key = d.date_key\n        WHERE d.year = 2025\n          AND d.month = 11\n        GROUP BY d.date\n        ORDER BY d.date;\n    "
      },
      {
        "question": "วันที่ 11/11/2025 สาขาไหนเสียโอกาสขาย (Demand > Stock) สูงที่สุด?",
        "intent": "lost_opportunity_by_branch_on_date",
        "sql": "\n        SELECT\n            b.branch_code,\n            b.branch_name,\n            SUM(r.reg_count) AS demand,\n            SUM(i.stock_qty) AS stock,\n            SUM(r.reg_count) - SUM(i.stock_qty) AS lost_opportunity\n        FROM fact_registration r\n        JOIN fact_inventory_snapshot i\n          ON r.date_key   = i.date_key\n         AND r.branch_id  = i.branch_id\n         AND r.product_id = i.product_id\n        JOIN dim_branch b ON r.branch_id = b.branch_id\n        WHERE r.date_key = 20251111\n        GROUP BY b.branch_code, b.branch_name\n        HAVING SUM(r.reg_count) > SUM(i.stock_qty)\n        ORDER BY lost_opportunity DESC;\n    "
      }
    ],
    "signature": {
      "instructions": "Convert a top-management business question into DuckDB SQL using the iPhone Gold Datamart.\n\nTables:\n- fact_registration(date_key, branch_id, product_id, reg_count)\n- fact_contract(date_key, branch_id, product_id, contract_count)\n- fact_inventory_snapshot(date_key, branch_id, product_id, stock_qty)\n- dim_date(date_key, date, year, month, day)\n- dim_product(product_id, model_name, generation, storage_gb, color, base_price)\n- dim_branch(branch_id, branch_code, branch_name, region)\n\nRules:\n- date_key = INT YYYYMMDD format\n- Revenue = SUM(contract_count * base_price)",
      "fields": [
        {
          "prefix": "Question:",
          "description": "${question}"
        },
        {
          "prefix": "Reasoning: Let's think step by step in order to",
          "description": "${reasoning}"
        },
        {
          "prefix": "Intent:",
          "description": "${intent}"
        },
        {
          "prefix": "Sql:",
          "description": "${sql}"
        }
      ]
    },
    "lm": null
  },
  "metadata": {
    "dependency_versions": {
      "python": "3.13",
      "dspy": "3.0.4",
      "cloudpickle": "3.1"
    }
  }
}
